# GetAPI with Cache Merging

This module provides a higher-order function that wraps a GET API client with caching capabilities. It allows for efficient API usage by caching responses based on request path and configuration, preventing redundant network requests.

## Features

- **Response Caching**: Automatically caches API responses to reduce network requests
- **TTL-based Expiration**: Cache entries expire after a configurable time-to-live
- **Size-limited Cache**: Automatically removes oldest entries when the cache size exceeds the configured limit
- **Cache Management**: Provides methods to clear the cache when needed
- **Error Handling**: Automatically removes failed requests from the cache

## Usage

```typescript
import { createGetAPIWithMerging } from './create-get-api-with-merging'

// Create an enhanced API client with default cache options
const apiClient = createGetAPIWithMerging((path, config) =>
  fetch(path, config).then(res => res.json())
)

// Use the enhanced API client
const userData = await apiClient('/users/123', {
  headers: { 'Content-Type': 'application/json' }
})

// Subsequent identical calls will use the cached response
const cachedUserData = await apiClient('/users/123', {
  headers: { 'Content-Type': 'application/json' }
})

// Clear the entire cache when needed
apiClient.clearCache()
```

## API Reference

### `createGetAPIWithMerging(getAPI, options?)`

Creates an enhanced API client with caching capabilities.

#### Parameters:

- `getAPI`: `(path: string, config: any) => Promise<any>` - The original API client function
- `options`: Optional cache configuration object
  - `ttl`: `number` - Time-to-live in milliseconds (default: 1000)
  - `maxEntries`: `number` - Maximum number of entries in the cache (default: 5)

#### Returns:

- An enhanced API client function with the same signature as the original, plus a `clearCache()` method

### `clearCache()`

A method on the enhanced API client that clears the entire cache.

## Cache Behavior

1. **Cache Key Generation**: Requests are cached based on their path and configuration
2. **TTL-based Expiration**: Cache entries are automatically removed after the configured TTL
3. **LRU-like Behavior**: When the cache exceeds the maximum size, the oldest entries are removed first
4. **Error Handling**: Failed requests are automatically removed from the cache

## Implementation Details

The module uses a `LocalCache` class internally to manage the cached promises. This class:

- Maintains a queue of keys to track entry order
- Automatically removes entries after their TTL expires
- Removes the oldest entries when the cache size exceeds the limit

The cache key is generated by combining the request path and configuration properties, ensuring that requests with different parameters are cached separately.

## Performance Considerations

- **Memory Usage**: The cache size is limited by the `maxEntries` option
- **Concurrency**: Concurrent requests for the same resource will share the cached promise
- **Cache Size**: For high-traffic applications, consider increasing the `maxEntries` value

## Examples

### Custom Cache Configuration

```typescript
const apiClient = createGetAPIWithMerging(
  (path, config) => fetch(path, config).then(res => res.json()),
  {
    ttl: 60000, // 1 minute cache lifetime
    maxEntries: 100 // Store up to 100 different requests
  }
)
```

### Usage with Axios

```typescript
import axios from 'axios'
import { createGetAPIWithMerging } from './create-get-api-with-merging'

const axiosWithCache = createGetAPIWithMerging((path, config) =>
  axios.get(path, config).then(res => res.data)
)
```
